<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>救護車輔助系統</title>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script>

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
  <style>
    /* Necessary styling for map container */
    #map {
      background: #CCC;
      height: 400px; /* Adjust the height as needed */
    }
  </style>

</head>
<body>
    <h1>輸入現在位置</h1>
    <form method="post">
        <input type="text" name="current_address" placeholder="輸入現在位置">
        <input type="submit" value="搜尋最近的災害位置">
    </form>

    {% if closest_location_info and distance_info %}
    <h2>結果:</h2>
    <p>{{ closest_location_info }}</p>
    <p>{{ distance_info }}</p>
    {% endif %}

    <h2>上傳新的災害位置</h2>
    <form method="post">
        <input type="text" name="new_address" placeholder="輸入災害位置">
        <input type="submit" value="更新">
    </form>

    <h2>所有災害地點</h2>
    <ul>
        {% for location in chinese_address_list %}
     <li>{{ location }}</li>
        {% endfor %}
    </ul>

    <h3>Google 地圖</h3>
    <div class="container">
        <div class="row">
          <div class="col">
            <div id="map"></div>
          </div>
        </div>
    </div>

    <!-- Google Maps API with your API Key -->
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDcI0vxTU33OBI8IlG5UUjeOtEvbg9Fh2g&callback=initMap" async defer></script>

  <!-- JavaScript to initialize the map -->
    

  <script>
    let map;
    
    
    
    
    function initMap() {
      // Set the default location (Taipei City Hall Theater)
      const center = { lat: 25.0374865, lng: 121.5647688 };
      // Create the map
      map = new google.maps.Map(document.getElementById('map'), {
        center: center,
        zoom: 15,
        mapTypeId: 'terrain'
      });
      // 使用 AJAX 請求獲取 Python 變數的值
      //locations 放災害地點
      var locations = [];
      
      fetch('/get_variable')
        .then(response => response.json())//把資料轉成JSON格式
        .then(data => {
            //jsVariable = map_list
            var jsVariable = data.variable;
            //titleList = chineae_address_list
            var titleList = data.variable2;
            // 印在console做檢查用
            console.log(jsVariable);
            console.log(titleList);
            //將每個地點加入locations
            for (var i= 0; jsVariable.length >i ; i++) {
              locations[i] = {
                position: { lat: jsVariable[i][0], lng: jsVariable[i][1] },
                map: map,
                title: titleList[i]
              };
            } 
            // 檢查用
            console.log(locations);
            // Place markers
            for (var i= 0; locations.length >i ; i++) {
              marker = new google.maps.Marker(locations[i]);
            }
        });
 
    }
    
  </script>

</body>
</html>
